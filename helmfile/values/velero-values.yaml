# Velero configuration for backup and disaster recovery
# Backs up Kubernetes resources and persistent volumes to cloud storage

# Image configuration
image:
  repository: velero/velero
  tag: v1.12.1
  pullPolicy: IfNotPresent

# Resource limits
resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Init containers
initContainers:
  # Plugin for AWS (if using S3)
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.8.2
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins

# Credentials for cloud provider
# Create secret manually: kubectl create secret generic cloud-credentials --from-file=cloud=credentials-velero -n velero
credentials:
  useSecret: true
  existingSecret: cloud-credentials
  secretContents: {}

# Configuration for cloud provider
configuration:
  # Provider: aws, azure, gcp, etc.
  provider: ""  # Set in environment-specific values
  
  # Backup storage location (BSL)
  backupStorageLocation:
    - name: default
      provider: ""  # Set in environment-specific values
      bucket: ""  # Set in environment-specific values
      default: true
      config: {}
      # AWS example:
      # config:
      #   region: us-west-2
      #   s3ForcePathStyle: "false"
      # Azure example:
      # config:
      #   resourceGroup: my-rg
      #   storageAccount: velerobackups
      
  # Volume snapshot location (VSL)
  volumeSnapshotLocation:
    - name: default
      provider: ""  # Set in environment-specific values
      config: {}
      # AWS example:
      # config:
      #   region: us-west-2

  # Default backup TTL (30 days)
  defaultBackupTTL: 720h
  
  # Default volume snapshot locations
  defaultVolumesToFsBackup: false
  
  # Features to enable
  features: ""
  
  # Log level: debug, info, warning, error, fatal, panic
  logLevel: info
  
  # Log format: text, json
  logFormat: text
  
  # Restore resource priorities
  defaultItemOperationTimeout: 4h
  
  # Default restic maintenance mode
  defaultResticMaintenanceFrequency: 168h  # Weekly

# Schedules for automated backups
schedules:
  # Daily full cluster backup
  daily-backup:
    disabled: false
    schedule: "0 2 * * *"  # 2 AM daily
    useOwnerReferencesInBackup: false
    template:
      ttl: 720h  # 30 days
      includedNamespaces:
        - '*'
      excludedNamespaces:
        - kube-system
        - kube-public
        - kube-node-lease
      storageLocation: default
      volumeSnapshotLocations:
        - default
      includeClusterResources: true
      snapshotVolumes: true
      defaultVolumesToFsBackup: false

# Metrics
metrics:
  enabled: true
  scrapeInterval: 30s
  scrapeTimeout: 10s
  serviceMonitor:
    enabled: true
    namespace: monitoring

# Service account
serviceAccount:
  server:
    create: true
    name: velero

# RBAC
rbac:
  create: true
  clusterAdministrator: true

# Deploy restic for file-level backups
deployRestic: true

# Restic configuration
restic:
  podVolumePath: /var/lib/kubelet/pods
  privileged: false
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  tolerations: []

# Node-agent (replacement for restic in newer versions)
deployNodeAgent: false

# Cleanup CRDs on uninstall
cleanUpCRDs: false

# Kubectl image for init jobs
kubectl:
  image:
    repository: docker.io/bitnami/kubectl
    tag: ""

# Upgrade job hook
upgradeCRDs: true

# Security context
securityContext:
  fsGroup: 65534
  runAsUser: 65534
  runAsGroup: 65534
  runAsNonRoot: true

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsGroup: 65534

# Priority class
priorityClassName: ""

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Node selector
nodeSelector: {}

# Backup sync period
backupSyncPeriod: 1m

# Restore-only mode
restoreOnlyMode: false
