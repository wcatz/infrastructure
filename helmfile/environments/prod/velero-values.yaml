# Velero Production Environment Overrides
# Comprehensive backup strategy for production

configuration:
  backupStorageLocation:
    - name: default
      provider: aws
      bucket: prod-k3s-backups
      config:
        region: us-west-2
        # Use server-side encryption
        serverSideEncryption: AES256

  volumeSnapshotLocation:
    - name: default
      provider: aws
      config:
        region: us-west-2

# Production backup schedules
schedules:
  # Hourly backups for critical namespaces
  hourly-critical:
    disabled: false
    schedule: "0 * * * *"  # Every hour
    template:
      ttl: "72h"  # 3 days retention
      includedNamespaces:
        - production
        - databases

  # Daily full backups
  daily:
    disabled: false
    schedule: "0 0 * * *"  # Midnight daily
    template:
      ttl: "720h"  # 30 days retention

  # Weekly backups
  weekly:
    disabled: false
    schedule: "0 0 * * 0"  # Sunday midnight
    template:
      ttl: "2160h"  # 90 days retention

resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# High availability
podAntiAffinity: "true"

initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.8.0
    volumeMounts:
      - mountPath: /target
        name: plugins

# Monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
