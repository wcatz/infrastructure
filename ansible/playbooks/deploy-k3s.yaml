---
# k3s Deployment Playbook
# Deploys k3s for hybrid cluster (Traefik and servicelb disabled)
# Uses Tailscale for L3 mesh networking and Cloudflared for HTTP/S ingress
#
# IMPORTANT: This playbook uses encrypted secrets from group_vars/all/vault.yml
# Ensure you have:
# 1. Created and encrypted vault.yml with your k3s_token
# 2. Set up .vault_pass file with your vault password
#
# Run with: ansible-playbook -i inventory.ini playbooks/deploy-k3s.yaml

- name: Deploy k3s Server
  hosts: k3s_servers
  become: true
  roles:
    - k3s
  vars:
    k3s_server_enabled: true
    k3s_agent_enabled: false

- name: Deploy k3s Agents
  hosts: k3s_agents
  become: true
  roles:
    - k3s
  vars:
    k3s_server_enabled: false
    k3s_agent_enabled: true
